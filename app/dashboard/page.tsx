import { checkSettings } from "@/actions/settingsActions";
import DashboardHeader from "@/components/shared/Header";
import MonthlySpendingTrend from "@/components/shared/trendChart";
import { getCurrentUser, isAuthenticated } from "@/lib/auth/auth-functions";
import { redirect } from "next/navigation";
import { getDashboardStats } from "@/actions/dashboardActions";
import SpendingByChart from "@/components/shared/pieChart";

export default async function Dashboard() {
  const valid = await isAuthenticated();
  const user = await getCurrentUser();
  if (!valid || !user) redirect("/login");

  const name = user?.name || "User";

  const settings = await checkSettings();
  if (!settings.success) redirect("/onboarding");

  const stats = await getDashboardStats();

  if (!stats) {
    console.error("Failed to fetch dashboard stats:");
    return;
  }

  function formatNumber(value: number | string): string {
    if (value == null || isNaN(Number(value))) return "0";
    return Math.round(Number(value))
      .toString()
      .replace(/\B(?=(\d{3})+(?!\d))/g, ".");
  }

  function formatYMD(dateStr: Date) {
    const date = new Date(dateStr);
    return `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(
      2,
      "0"
    )}.${String(date.getDate()).padStart(2, "0")}`;
  }

  return (
    <div className="flex flex-col p-8 my-12 gap-8 mx-auto mt-0 mb-auto">
      <DashboardHeader />

      {/* Top Summary Cards */}
      <section className="flex flex-wrap w-full justify-between gap-4">
        <div className="flex gap-4 p-4 rounded-2xl shadow-sm bg-white/5 border border-white/10 items-center min-w-[250px] flex-1">
          <svg
            width="131"
            height="155"
            viewBox="0 0 131 155"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            className="h-6 w-auto"
          >
            <path
              d="M99.4406 72.939C101.649 70.7482 103.444 68.7175 105.499 66.9946C107.987 64.869 110.618 62.9173 113.375 61.1531C116.923 58.9288 119.79 60.0459 120.829 64.1605C122.273 69.8706 123.43 75.6556 124.57 81.4366C126.705 92.2846 127.229 103.122 123.64 113.802C117.178 133.038 104.101 145.25 84.375 150.032C76.9522 151.839 69.4392 153.253 61.8672 154.268C23.8502 159.312 2.92808 129.486 0.59874 106.133C-1.14777 88.6353 4.33197 73.239 13.8902 59.2925C20.1556 50.1503 28.0225 42.1089 35.1149 33.5273C39.4231 28.3146 43.8087 23.1499 47.8084 17.7056C50.951 13.4276 52.3838 8.34029 53.2895 3.10731C53.4972 1.89103 54.1561 0.797902 55.1345 0.0461882C55.5939 -0.245226 57.0379 0.914488 57.9817 1.50388C59.5536 2.48445 61.0776 3.54245 62.6305 4.55386C80.181 15.982 90.7421 32.3118 95.7756 52.3583C97.2596 58.2653 97.9691 64.3692 99.0304 70.3826C99.1538 71.0875 99.2568 71.799 99.4406 72.939ZM58.1169 8.08168C56.4688 17.2763 52.0615 24.6371 46.5319 31.3817C41.1978 37.8906 35.7279 44.2873 30.2908 50.7109C21.6698 60.8953 14.8734 72.0234 10.8835 84.9178C2.01576 113.577 20.7286 149.411 58.4444 146.975C68.6505 146.318 78.8158 146.241 88.3964 141.451C103.801 133.749 114.224 122.337 117.856 105.236C120.488 92.8451 116.795 81.0829 114.467 68.6781C108.126 73.6663 103.352 79.1795 100.578 86.2903C100.023 87.7126 99.5436 89.1736 98.8761 90.542C98.0321 92.2708 96.5973 93.2592 94.6191 92.8549C92.4375 92.408 91.6347 90.7796 91.7095 88.7115C91.7883 86.5278 92.0227 84.3508 92.1421 82.1684C93.1975 62.8682 89.0054 44.8379 78.7981 28.356C73.682 19.9956 66.5773 13.0306 58.1169 8.08168Z"
              fill="white"
              fillOpacity="0.8"
            />
            <path
              d="M122.988 7.4531C123.764 9.78507 124.522 12.1236 125.322 14.4477C126.982 19.2705 129.194 23.9757 130.229 28.9278C132.356 39.1076 127.024 47.1084 117.037 49.7403C113.662 50.6284 111.312 49.3596 110.042 46.1429C109.487 44.7528 108.779 43.4289 107.931 42.1957C102.496 34.2737 101.201 26.0643 105.708 17.2175C108.639 11.4634 112.945 6.84736 117.465 2.40855C118.298 1.5914 120.199 1.05646 121.202 1.44239C122.23 1.83619 122.921 3.45468 123.453 4.67088C123.774 5.40401 123.512 6.39252 123.512 7.2661L122.988 7.4531ZM116.612 12.4413C109.112 19.806 104.692 31.3937 114.528 41.9515C120.662 40.1105 123.034 36.542 122.509 30.3297C121.965 23.8865 119.061 18.2729 116.612 12.4426V12.4413Z"
              fill="white"
              fillOpacity="0.8"
            />
            <path
              d="M69.4695 94.3423C71.1385 90.3885 72.6743 86.7997 74.1675 83.1925C74.9604 81.2767 75.9829 79.6411 78.3287 79.5826C80.4808 79.5315 81.6892 80.9235 82.6205 82.6267C87.1834 90.9707 91.5572 99.4171 93.519 108.819C96.8197 124.632 87.0298 139.624 71.3741 143.4C60.6148 145.994 50.4461 144.269 40.884 139.348C29.9612 133.728 25.0931 123.845 24.3902 112.054C23.0467 89.49 37.9659 66.679 59.0724 58.2667C60.6929 57.6209 62.2432 56.6968 63.9201 56.3286C65.28 56.0299 67.2753 55.8285 68.0924 56.5701C68.6078 57.1514 68.9948 57.8347 69.2283 58.5755C69.4618 59.3163 69.5366 60.098 69.4478 60.8697C69.0455 63.6519 67.9487 66.3285 67.2162 69.0694C64.6191 78.8331 65.2321 86.2477 69.4695 94.3423ZM60.1153 64.7487C59.5733 64.9523 59.0419 65.1829 58.523 65.4398C41.9302 74.4763 33.7739 89.1678 32.007 107.296C30.4738 123 40.3694 135.004 55.8761 138.078C56.616 138.269 57.3899 138.289 58.1384 138.135C63.0485 136.704 68.0393 135.465 72.803 133.64C81.9517 130.134 87.0455 120.994 85.6514 111.341C84.5902 104.008 81.5612 97.3726 78.3746 90.7935C78.309 90.6622 78.0143 90.6478 77.2116 90.3525C76.1004 94.1251 74.8744 97.8203 73.9444 101.588C73.139 104.853 70.0477 106.21 67.3153 104.222C66.6977 103.77 66.1628 103.215 65.7342 102.581C61.5337 96.3061 58.4745 89.5018 58.5014 81.8778C58.5211 76.2674 59.5213 70.6629 60.1153 64.75V64.7487Z"
              fill="white"
              fillOpacity="0.8"
            />
          </svg>
          <div className="flex flex-col">
            <div className="font-medium text-white/80">
              Active subscriptions
            </div>
            <div className="text-xl font-bold text-white">
              {stats.activeCount}
            </div>
            <div className="text-sm text-white/50">
              {stats.addedThisMonthCount} added this month
            </div>
          </div>
        </div>

        <div className="flex gap-4 p-4 rounded-2xl shadow-sm bg-white/5 border border-white/10 items-center min-w-[250px] flex-1">
          <svg
            width="157"
            height="148"
            viewBox="0 0 157 148"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            className="h-6 w-auto"
          >
            <g clipPath="url(#clip0_8_2800)">
              <path
                d="M38.6174 11.6714C38.6174 9.22676 38.5662 6.98592 38.6303 4.74777C38.7093 1.9877 39.4323 0.780865 40.912 0.682198C42.3918 0.583532 43.2106 1.63988 43.6307 4.4324C43.9544 6.55568 44.1187 8.70155 44.4074 11.3357L111.435 10.7582C111.572 9.35087 111.67 8.0856 111.824 6.8276C111.983 5.54626 112.142 4.26041 112.406 2.99787C112.727 1.46659 113.641 0.46954 115.293 0.45526C117.088 0.439032 118.118 1.51198 118.405 3.16205C118.737 5.07307 118.849 7.02292 119.052 8.95601C119.108 9.4792 119.155 10.0036 119.236 10.8384C122.4 11.0026 125.478 11.2513 128.558 11.3065C142.155 11.5493 149.818 19.9339 152.541 31.7298C153.912 37.6686 154.21 43.9041 154.527 50.0292C155.266 64.2703 155.804 78.5256 156.261 92.7758C156.52 100.76 156.459 108.759 156.526 116.751C156.664 132.909 144.437 141.555 133.689 144.484C129.955 145.535 126.108 146.134 122.232 146.269C99.607 146.824 76.9766 147.444 54.3475 147.459C42.2785 147.468 30.2892 145.546 18.483 142.984C9.42075 141.019 2.43696 132.588 1.35467 122.835C1.02216 119.612 0.884885 116.371 0.943625 113.131C1.06273 102.003 1.40001 90.8771 1.44791 79.7492C1.50422 66.7862 1.37732 53.822 1.25369 40.859C1.22003 37.3038 0.990901 33.8485 2.27774 30.338C5.86768 20.5467 12.9039 15.137 22.9203 13.4298C26.9458 12.743 31.0523 12.5335 35.1213 12.0986C36.1777 11.9857 37.2205 11.8427 38.6174 11.6714ZM146.224 49.0038C123.214 49.7588 100.719 50.5615 78.2195 51.2177C55.6284 51.8792 33.0291 52.3998 10.2654 52.9867C10.2421 53.2612 10.1618 53.7787 10.1612 54.296C10.1396 71.5858 10.1259 88.8759 10.1198 106.166C10.1198 110.809 10.0959 115.457 10.3076 120.093C10.4437 123.359 11.6846 126.48 13.8258 128.945C15.9671 131.409 18.8811 133.069 22.0884 133.651C35.1639 135.873 48.2304 137.935 61.5784 137.574C73.7524 137.244 85.9379 137.36 98.115 137.112C107.807 136.917 117.497 136.538 127.179 136.098C131.402 135.878 135.481 134.485 138.96 132.073C143.656 128.901 146.812 124.747 146.914 118.766C146.994 114.125 147.293 109.484 147.221 104.844C146.948 87.2349 146.561 69.6274 146.222 52.0197C146.206 50.9564 146.226 49.8931 146.226 49.0038H146.224ZM9.40004 44.9297C54.9669 42.489 99.8116 40.8995 144.935 39.8219C144.676 37.5208 144.641 35.3429 144.158 33.2702C142.664 26.8848 139.868 21.4187 132.926 19.522C128.521 18.3185 124.004 18.6662 119.332 18.7733C119.228 19.8029 119.161 20.644 119.052 21.4795C118.962 22.3372 118.824 23.1894 118.64 24.032C117.982 26.7102 116.634 27.9266 114.556 27.7818C112.464 27.6377 111.268 26.2312 111.079 23.4744C110.971 21.9009 111.06 20.3138 111.06 18.8111H44.9162C44.9162 20.3462 44.9453 21.5109 44.9091 22.6728C44.908 24.2893 44.8215 25.9044 44.6502 27.5118C44.5905 28.2807 44.2425 28.9985 43.6763 29.5206C43.1102 30.0427 42.3679 30.3303 41.5988 30.3257C39.7863 30.4348 38.7571 29.2872 38.3558 27.7254C38.1206 26.4554 38.0189 25.1641 38.0522 23.8728C37.9939 22.4181 37.994 20.9608 37.9623 19.0998C33.0628 19.5146 28.5809 19.4471 24.3041 20.3571C17.1909 21.8715 11.3419 25.4107 10.0273 33.3618C9.42204 37.0365 9.59682 40.8415 9.40004 44.9297Z"
                fill="white"
                fillOpacity="0.8"
              />
              <path
                d="M40.5799 123.022C39.6297 123.064 37.8043 123.217 35.9789 123.21C32.0219 123.201 29.6088 121.406 28.8728 117.563C27.9763 113.107 28.1739 108.501 29.4488 104.139C29.6864 103.195 30.1734 102.332 30.8583 101.643C31.5433 100.953 32.4009 100.461 33.3411 100.218C38.5107 98.7093 43.9077 98.1413 49.2771 98.5392C52.1537 98.7391 54.379 100.346 55.038 103.369C56.0361 107.939 56.3042 112.557 55.0633 117.131C54.0218 120.967 51.5582 122.863 47.5805 123.01C45.5428 123.084 43.4992 123.022 40.5799 123.022ZM45.3311 107.561H36.9252L37.2812 113.172H45.3311V107.561Z"
                fill="white"
                fillOpacity="0.8"
              />
              <path
                d="M92.565 108.474C92.565 109.574 92.5799 110.223 92.565 110.871C92.3864 117.589 90.2309 120.202 83.6005 121.36C80.2125 121.952 76.7792 122.343 73.3505 122.633C69.6324 122.948 67.1364 121.288 66.4075 117.791C65.485 113.349 64.9445 108.842 65.9143 104.296C66.5965 101.101 68.4802 98.9735 71.6597 98.4984C75.9119 97.8337 80.1989 97.4156 84.4996 97.2475C89.3013 97.095 91.3889 99.0449 92.1378 103.765C92.4013 105.466 92.4511 107.202 92.565 108.474ZM82.928 106.437H73.6567C73.9674 108.86 74.2457 111.023 74.5331 113.264C76.6187 113.06 78.3237 112.908 80.0255 112.724C83.1066 112.391 83.4393 112.01 83.2931 108.865C83.2568 108.133 83.0762 107.409 82.9254 106.437H82.928Z"
                fill="white"
                fillOpacity="0.8"
              />
              <path
                d="M115.165 121.917C113.124 122.01 111.08 121.998 109.04 121.88C105.343 121.49 103.188 119.533 102.966 115.908C102.703 111.925 102.752 107.928 103.111 103.953C103.5 99.8881 105.338 98.2296 109.408 97.909C113.371 97.5961 117.366 97.5072 121.342 97.5896C125.539 97.6772 129.492 100.381 129.181 105.915C129.029 108.608 128.982 111.317 128.636 113.987C127.974 119.09 125.479 121.329 120.323 121.718C118.605 121.848 116.885 121.938 115.166 122.046L115.165 121.917ZM111.181 105.439C111.31 108.201 111.408 110.296 111.504 112.315H119.039C119.233 110.227 119.392 108.442 119.582 106.364L111.181 105.439Z"
                fill="white"
                fillOpacity="0.8"
              />
              <path
                d="M114.832 86.8755C113.007 86.9787 111.181 87.1813 109.357 87.1637C104.859 87.1209 102.516 84.9905 102.292 80.5304C102.118 77.0842 102.118 73.6321 102.292 70.1866C102.513 65.8732 104.062 64.0263 108.317 63.5803C113.018 63.0819 117.744 62.8762 122.47 62.9648C126.857 63.0538 129.194 65.5259 129.171 70.0133C129.123 73.6711 128.748 77.3172 128.05 80.9075C127.35 84.6458 125.106 86.3835 121.275 86.6535C119.139 86.8048 116.979 86.6808 114.829 86.6808L114.832 86.8755ZM110.3 78.1293H119.521C119.771 75.9002 119.992 73.9216 120.273 71.3998L110.3 70.959V78.1293Z"
                fill="white"
                fillOpacity="0.8"
              />
              <path
                d="M63.3293 75.4114C63.5449 73.2693 63.6808 71.0026 64.0226 68.7644C64.411 66.2328 65.6701 64.2777 68.3597 63.7298C73.1173 62.7607 77.9009 61.938 82.7868 62.5203C87.0531 63.0279 89.3679 64.8488 89.9595 69.1156C90.3544 72.3093 90.3019 75.5432 89.8048 78.7226C89.3064 82.1629 86.8758 84.2297 83.4256 84.6822C79.2622 85.2274 75.0754 85.6611 70.8861 85.9194C66.8366 86.17 64.3851 84.098 63.6854 80.0585C63.4303 78.5791 63.4472 77.0511 63.3293 75.4114ZM80.8138 71.1434L71.156 70.5028C71.3068 72.9116 71.4227 74.7688 71.556 76.8947L80.8125 75.9619L80.8138 71.1434Z"
                fill="white"
                fillOpacity="0.8"
              />
            </g>
            <defs>
              <clipPath id="clip0_8_2800">
                <rect
                  width="156"
                  height="148"
                  fill="white"
                  transform="translate(0.777344)"
                />
              </clipPath>
            </defs>
          </svg>
          <div className="flex flex-col">
            <div className="font-medium text-white/80">
              Remaining this month
            </div>
            <div className="text-xl font-bold text-white">
              {formatNumber(stats.remainingThisMonth)}
              {stats.currency}
            </div>
            <div className="text-sm text-white/50">
              Next month: {formatNumber(stats.remainingNextMonth)}
              {stats.currency}
            </div>
          </div>
        </div>

        <div className="flex gap-4 p-4 rounded-2xl shadow-sm bg-white/5 border border-white/10 items-center min-w-[250px] flex-1">
          <svg
            width="164"
            height="147"
            viewBox="0 0 164 147"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            className="h-6 w-auto"
          >
            <g clipPath="url(#clip0_8_2793)">
              <path
                d="M70.2245 82.5742C69.1244 82.7283 68.388 83.7392 67.7386 84.6335C67.5691 84.866 67.4067 85.0926 67.245 85.2862C64.9222 88.0773 62.6384 90.9299 60.22 93.9489C59.3826 94.9941 58.5224 96.0665 57.6392 97.166C56.4625 96.1325 55.3033 95.1132 54.1616 94.1082C50.7997 91.1488 47.6235 88.3525 44.3803 85.5595L44.2173 85.419C42.9465 84.1996 41.4895 83.1894 39.9008 82.4259C38.8059 81.9726 36.4485 82.5075 35.9393 83.5553C35.4744 84.5137 35.7848 85.7447 36.0576 86.8314C36.1225 87.0755 36.1795 87.3151 36.2288 87.5437C36.2976 87.7509 36.4087 87.942 36.5548 88.1045C36.701 88.2664 36.8792 88.3972 37.0783 88.4872C37.1948 88.5546 37.3052 88.631 37.4087 88.7158C41.574 92.7852 45.7348 96.8597 49.9475 100.985L52.4347 103.421L49.4617 107.112C46.4004 110.912 43.236 114.841 40.0955 118.68C39.2623 119.697 38.0051 121.233 39.3084 123.018C39.581 123.416 39.9466 123.741 40.3735 123.965C40.8005 124.19 41.2758 124.308 41.7586 124.308C42.6009 124.282 43.4158 124.004 44.0965 123.508C45.5048 122.521 46.764 121.338 47.8363 119.995C50.3598 116.907 52.7837 113.833 55.3495 110.578C56.1945 109.507 57.0468 108.428 57.9062 107.34C58.0707 107.459 58.2323 107.578 58.3916 107.694C59.0988 108.212 59.7673 108.696 60.4914 109.126L62.0439 110.048C66.0176 112.41 70.1271 114.853 74.2475 117.125C75.0391 117.472 75.908 117.608 76.7679 117.519C77.1283 117.519 77.4686 117.512 77.7848 117.538C77.8861 117.546 77.9881 117.532 78.0829 117.495C78.1771 117.458 78.2628 117.4 78.3316 117.326C78.4005 117.251 78.4511 117.162 78.4803 117.065C78.5096 116.968 78.516 116.865 78.4992 116.765C78.4492 116.416 78.4186 116.064 78.4069 115.711C78.3569 114.767 78.305 113.79 77.7088 113.121C75.3619 110.46 72.8325 107.964 70.1388 105.653C68.4256 104.249 66.6391 102.937 64.7857 101.723C64.1604 101.298 63.5345 100.872 62.9124 100.438C63.6462 99.3717 64.3695 98.3233 65.0826 97.293C67.2106 94.2144 69.2211 91.3055 71.2077 88.3415C71.3376 88.1472 71.4928 87.9394 71.6499 87.727C72.5052 86.5736 73.9352 84.6438 72.0116 83.1421C71.7688 82.9297 71.485 82.7698 71.1771 82.672C70.87 82.5742 70.5453 82.5412 70.2245 82.5742Z"
                fill="white"
                fillOpacity="0.8"
              />
              <path
                d="M32.2088 44.8775C32.3939 45.007 32.5753 45.1366 32.7428 45.2661C33.2608 45.5692 33.8697 45.68 34.4617 45.5788C34.5715 45.5736 34.6797 45.5687 34.783 45.5674C37.0918 45.5333 39.4006 45.4943 41.7095 45.4507C43.3931 45.4201 45.0772 45.3906 46.7614 45.3625C47.5563 45.3502 48.3505 45.3536 49.1538 45.3568H49.7383C49.9084 46.2965 50.063 47.2191 50.2221 48.1283C50.6631 50.7083 51.08 53.1451 51.7093 55.5878C52.1574 57.3304 52.8885 60.1752 55.462 60.1745C55.6446 60.1741 55.8268 60.1606 56.0075 60.1344C59.1662 59.6856 58.9609 56.0808 58.8739 54.5415C58.744 52.2218 58.4329 49.9093 58.105 47.4608C57.9874 46.5885 57.868 45.6956 57.7524 44.7734L58.0882 44.7222C58.7636 44.6186 59.4092 44.5194 60.0573 44.4436C60.9756 44.3348 61.8958 44.2372 62.8166 44.1407C64.6291 43.9465 66.5041 43.7522 68.3412 43.4647C69.5504 43.2756 72.3818 42.8325 72.2422 39.8135C72.1065 36.8456 69.5037 36.7874 67.9477 36.7518C66.9736 36.733 65.993 36.7516 65.0439 36.7698C64.4529 36.7814 63.862 36.7938 63.2704 36.7957C61.517 36.8022 59.77 36.8005 57.9179 36.7998H56.0075C55.9096 36.0693 55.813 35.3375 55.7173 34.6045C55.4296 32.4098 55.1328 30.1414 54.7867 27.9112C54.7425 27.6262 54.7147 27.3211 54.6855 27.0102C54.5381 25.4425 54.3151 23.0725 51.5409 23.066H51.5304C51.1193 23.0394 50.7072 23.0957 50.3185 23.2317C49.9298 23.3676 49.5723 23.5802 49.268 23.8571C48.3828 24.7482 48.3985 26.1082 48.4122 27.3081C48.4161 27.6378 48.4198 27.9558 48.4023 28.2491C48.2601 30.5804 48.2887 32.8871 48.3186 35.3292C48.329 36.1581 48.3394 36.9992 48.3427 37.8546C48.2213 37.8682 48.0977 37.8812 47.9723 37.8961C47.2203 37.9783 46.401 38.0683 45.5809 38.1291C42.9512 38.3208 40.3211 38.5064 37.691 38.6859L33.3075 38.9917C32.7564 38.9902 32.2113 39.1034 31.7065 39.3241C31.2018 39.5447 30.7487 39.8681 30.3763 40.2733C30.1586 40.564 30.0067 40.8985 29.9312 41.2535C29.8556 41.6084 29.858 41.9756 29.9384 42.3295C30.1352 43.3961 31.2347 44.1826 32.2088 44.8775Z"
                fill="white"
                fillOpacity="0.8"
              />
              <path
                d="M99.0073 43.1575C99.2158 43.1691 99.4619 43.1827 99.7139 43.1827C99.8353 43.1827 99.9587 43.1795 100.083 43.1717C102.328 43.0293 104.574 42.8912 106.82 42.7578C113.094 42.377 119.581 41.9846 125.955 41.4627C127.767 41.2274 129.54 40.7502 131.225 40.0439C131.633 39.8936 132.039 39.7439 132.444 39.6021C133.168 39.3489 134.189 38.2268 133.986 37.4251C133.861 36.9605 133.625 36.5332 133.296 36.1811C132.968 35.8291 132.558 35.5628 132.103 35.4059C130.467 35.0873 128.842 34.9124 127.41 34.7583C126.939 34.7071 126.5 34.6598 126.093 34.6106C126.046 34.6051 125.999 34.6051 125.953 34.6106C124.654 34.7233 123.424 34.8265 122.234 34.9256C119.745 35.1334 117.393 35.3302 115.071 35.5639C109.059 36.1707 103.084 36.8286 98.5502 37.3331C97.4267 37.4587 94.796 37.7515 95.0862 40.5147C95.3408 42.9554 97.5468 43.0765 99.0073 43.1575Z"
                fill="white"
                fillOpacity="0.8"
              />
              <path
                d="M132.387 99.4547C130.93 99.0493 129.409 98.9263 127.906 99.0933C117.091 100.129 108.056 101.065 99.4755 102.035C98.6949 102.211 97.9871 102.623 97.4494 103.214C97.2273 103.419 96.9948 103.611 96.7526 103.792C96.6688 103.85 96.5999 103.929 96.5512 104.019C96.5025 104.109 96.4753 104.21 96.472 104.312C96.4688 104.414 96.4889 104.516 96.5311 104.609C96.574 104.703 96.637 104.786 96.7168 104.85C96.9487 105.048 97.1701 105.258 97.3792 105.48C97.8786 106.135 98.5897 106.598 99.3924 106.789C101.164 106.932 102.942 106.97 104.717 106.904C105.216 106.895 105.716 106.886 106.215 106.882C106.249 106.941 106.294 106.994 106.345 107.04C106.466 107.145 106.622 107.203 106.783 107.203C106.802 107.204 106.822 107.204 106.84 107.203L112.256 106.732C117.957 106.235 123.659 105.732 129.359 105.221C130.44 105.172 131.503 104.931 132.498 104.508C133.198 104.165 134.679 103.07 134.528 102.056C134.409 101.482 134.152 100.945 133.779 100.492C133.406 100.039 132.928 99.6826 132.387 99.4547Z"
                fill="white"
                fillOpacity="0.8"
              />
              <path
                d="M101.315 95.2991C101.837 95.4332 102.376 95.496 102.916 95.4863C103.298 95.4863 103.68 95.4636 104.056 95.4429C104.316 95.428 104.583 95.4137 104.843 95.4073C104.943 95.4526 105.051 95.4727 105.16 95.4662C106.553 95.3859 107.946 95.3075 109.339 95.2324C112.53 95.0563 115.83 94.8737 119.074 94.6496C123.111 94.3679 127.061 94.0733 131.001 93.5656C131.796 93.3609 132.503 92.9044 133.015 92.2639C133.228 92.0438 133.454 91.8352 133.689 91.6384C133.765 91.5788 133.826 91.5037 133.869 91.4182C133.913 91.3321 133.937 91.2382 133.94 91.1423C133.944 91.0465 133.926 90.9506 133.889 90.8619C133.852 90.7732 133.797 90.6936 133.726 90.6288C133.493 90.4138 133.268 90.1852 133.043 89.9566C132.484 89.3336 131.838 88.7949 131.125 88.3564C130.43 88.0715 129.664 88.0055 128.93 88.1687C128.769 88.1874 128.612 88.2056 128.461 88.2172L126.777 88.3506C122.019 88.7288 117.101 89.1199 112.262 89.5584C109.261 89.8303 105.309 90.2137 101.365 90.7693C100.704 90.9383 100.11 91.3081 99.6678 91.8268C99.4963 91.9971 99.3151 92.159 99.1262 92.3106C99.0508 92.3682 98.9878 92.4414 98.943 92.5256C98.8976 92.6091 98.8716 92.7017 98.8651 92.7969C98.8593 92.8921 98.8735 92.9873 98.9073 93.076C98.9411 93.1654 98.9937 93.2457 99.0619 93.313C99.2502 93.5053 99.4288 93.7061 99.597 93.9165C100.015 94.5415 100.614 95.0239 101.315 95.2991Z"
                fill="white"
                fillOpacity="0.8"
              />
              <path
                d="M20.8226 144.103C25.4195 145.056 30.0848 145.646 34.7749 145.864C43.5042 146.22 52.3828 146.417 60.9698 146.608C64.461 146.686 67.9522 146.768 71.4427 146.852H71.4603C71.5895 146.853 71.7168 146.815 71.8252 146.744H74.5436C76.8503 146.744 79.1583 146.744 81.4675 146.744L85.1484 146.75C99.5989 146.778 114.544 146.807 129.134 144.527C134.224 143.731 140.17 142.621 145.678 140.412C156.733 135.982 162.699 127.814 163.407 116.133C163.862 108.621 163.518 101.056 163.184 93.7422C163.119 92.3383 163.057 90.9337 162.996 89.5285C162.42 75.7675 161.862 64.2783 161.237 53.3699C160.814 45.9726 160.211 36.2381 159.292 26.5407C157.953 12.3917 146.539 2.15092 131.536 1.63739C120.432 1.25597 109.132 1.09682 98.2007 0.942697C95.0888 0.899957 91.9223 0.925964 88.8603 0.951867C83.8346 0.993959 78.6394 1.0372 73.5559 0.769108C62.0107 0.162326 49.7711 0.670171 33.8776 2.42251C23.5391 3.56225 15.7592 6.59289 9.3905 11.9613C4.14139 16.3849 1.58277 21.5167 1.56978 27.6492C1.56523 29.6231 1.52553 31.6241 1.4515 33.5967C1.38656 35.3341 1.2665 37.1086 1.1509 38.8253C0.825255 42.4988 0.738233 46.1896 0.890888 49.8743C0.988298 51.4103 1.08785 52.946 1.18959 54.4817C1.97861 66.5181 2.79447 78.9639 1.96583 91.2432C1.62489 96.3028 1.71767 101.462 1.80728 106.452L1.82758 107.572C1.97824 116.139 3.23483 123.671 5.67008 130.598C8.29431 138.071 13.3928 142.615 20.8226 144.103ZM20.0067 13.746L20.1659 13.6596C24.6364 11.2118 29.5893 10.3572 34.2786 9.69861C44.9527 8.29822 55.7124 7.64902 66.478 7.75587C70.9635 7.75587 75.3859 7.83028 79.7226 7.92094C87.5966 8.08607 95.6031 8.19357 103.345 8.29654C110.129 8.38784 117.144 8.48161 124.042 8.61437C127.232 8.65244 130.415 8.9241 133.565 9.42662C144.889 11.3078 151.151 18.6499 151.676 30.6585C152.106 40.5237 152.503 50.5569 152.888 60.2602C153.175 67.5309 153.467 74.8019 153.766 82.0729C153.875 84.7034 154.025 87.374 154.171 89.9572C154.4 93.9993 154.636 98.1814 154.719 102.286C154.818 107.156 154.547 112.135 154.264 116.817C153.849 123.642 149.865 128.491 142.428 131.227C137.872 132.823 133.163 133.944 128.376 134.573C112.254 136.969 95.7083 136.865 79.707 136.761L77.5932 136.747C76.7626 136.743 75.9327 136.743 75.1047 136.747H73.9221C73.8176 136.747 73.715 136.772 73.6215 136.819C73.5286 136.866 73.4481 136.934 73.3857 137.017C69.879 136.928 66.3722 136.841 62.8653 136.758C52.6275 136.508 42.0412 136.248 31.6338 135.907C28.9492 135.745 26.2812 135.374 23.6539 134.801L23.1843 134.711C18.7846 133.873 15.8408 131.162 14.4348 126.655C12.3008 119.611 11.2333 112.289 11.2677 104.93C11.2443 101.566 11.2926 98.1412 11.3387 94.8282C11.4004 90.4098 11.4638 85.8412 11.3606 81.3444C11.1794 73.5236 10.782 65.0902 10.1125 54.8121C9.58324 46.7076 9.26107 36.0233 11.4957 25.1958C11.547 25.0476 11.5692 24.8905 11.5607 24.7339C11.0386 18.6505 15.396 16.2663 20.0067 13.744V13.746Z"
                fill="white"
                fillOpacity="0.8"
              />
            </g>
            <defs>
              <clipPath id="clip0_8_2793">
                <rect
                  width="163"
                  height="147"
                  fill="white"
                  transform="translate(0.777344)"
                />
              </clipPath>
            </defs>
          </svg>
          <div className="flex flex-col">
            <div className="font-medium text-white/80">Yearly Cost</div>
            <div className="text-xl font-bold text-white">
              {formatNumber(stats.yearlyCost)}
              {stats.currency}
            </div>
            <div className="text-sm text-white/50">
              AVG: {formatNumber(stats.yearlyCost / 12)}
              {stats.currency}/month
            </div>
          </div>
        </div>

        <div className="flex gap-4 p-4 rounded-2xl shadow-sm bg-white/5 border border-white/10 items-center min-w-[250px] flex-1">
          <svg
            width="129"
            height="105"
            viewBox="0 0 129 105"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            className="h-6 w-auto"
          >
            <g clipPath="url(#clip0_8_2360)">
              <path
                d="M67.945 60.297C51.0292 60.4965 34.1133 60.7037 17.1975 60.9186C14.9996 60.9499 12.8075 61.3678 10.6037 61.4833C8.84024 61.6036 7.06981 61.5862 5.30893 61.4312C3.69794 61.2629 2.34694 60.4529 1.91058 58.6992C1.49361 57.0238 2.07431 55.6842 3.31746 54.5103C6.45798 51.5429 9.60223 48.5755 12.6432 45.5057C26.5583 31.4579 40.8291 17.7988 56.021 5.15312C57.2151 4.15986 58.4258 3.18677 59.6328 2.20982C62.4733 -0.0890941 65.4677 -0.330374 68.5093 1.71289C70.4532 2.98984 72.3202 4.38069 74.1025 5.8783C82.6035 13.1787 91.1485 20.4329 99.4911 27.9146C106.841 34.5068 113.995 41.3259 121.122 48.1639C122.884 49.8428 124.387 51.7771 125.583 53.9031C127.42 57.2253 126.318 59.431 122.62 60.3029C121.108 60.6169 119.565 60.7465 118.022 60.689C101.329 60.4716 84.6367 60.2324 67.945 59.9715V60.297ZM113.099 52.3157C112.888 51.9706 112.657 51.6393 112.406 51.3237C98.5712 36.6974 83.4924 23.4348 68.3257 10.2668C67.6573 9.68567 66.8854 9.22328 66.2241 8.63632C65.0067 7.55436 63.924 7.68943 62.7054 8.70551C60.4059 10.6229 57.9171 12.3199 55.6991 14.324C42.856 25.9301 30.0527 37.5786 17.2893 49.2694C15.604 50.8131 14.2076 52.6783 12.6309 54.4464L113.099 52.3157Z"
                fill="white"
                fillOpacity="0.8"
              />
              <path
                d="M64.2931 74.2638C83.4285 74.4627 102.564 74.6694 121.699 74.884C123.017 74.9036 124.326 75.1103 125.586 75.499C126.394 75.7449 127.102 76.2444 127.608 76.9246C128.115 77.6055 128.392 78.4312 128.4 79.2816C128.529 81.2023 127.724 82.9083 125.904 83.6146C124.372 84.2244 122.74 84.5394 121.093 84.5447C110.365 84.3947 99.6379 84.1683 88.9124 83.8651C69.1216 83.3238 49.3314 82.7499 29.5418 82.1433C22.5774 81.9386 15.6125 81.7462 8.65073 81.4657C7.21553 81.4057 5.79557 81.1423 4.43293 80.6831C2.11407 79.9005 0.92993 77.8136 1.39474 75.7697C1.85437 73.7479 3.38334 72.6523 5.91684 72.7436C10.3367 72.9033 14.7514 73.2888 19.1694 73.3553C34.2106 73.5816 49.2537 73.7101 64.2963 73.877L64.2931 74.2638Z"
                fill="white"
                fillOpacity="0.8"
              />
              <path
                d="M66.1129 93.0323C82.6346 93.6115 101.524 94.2525 120.41 94.9706C122.166 95.0352 123.902 95.373 125.556 95.971C126.458 96.2828 127.23 96.8938 127.744 97.7051C128.258 98.5165 128.483 99.4797 128.384 100.437C128.327 101.34 127.983 102.201 127.402 102.891C126.82 103.579 126.032 104.059 125.157 104.259C123.562 104.67 121.918 104.854 120.273 104.807C111.777 104.374 103.29 103.769 94.7959 103.311C83.431 102.699 72.0655 102.064 60.6927 101.63C50.5335 101.243 40.366 101.069 30.2003 100.889C23.9044 100.778 17.6051 100.868 11.3086 100.785C9.53972 100.747 7.77726 100.559 6.03933 100.224C4.98301 100.029 3.71209 99.7308 3.04817 99.0043C2.66867 98.5712 2.37845 98.0665 2.19463 97.5193C2.01082 96.9715 1.93694 96.3923 1.97747 95.8158C2.10676 94.9784 3.24579 94.1508 4.12046 93.6362C4.71585 93.2854 5.62732 93.4536 6.39855 93.4406C13.9079 93.2991 21.4167 93.093 28.926 93.0493C40.5307 92.9841 52.136 93.0323 66.1129 93.0323Z"
                fill="white"
                fillOpacity="0.8"
              />
            </g>
            <defs>
              <clipPath id="clip0_8_2360">
                <rect
                  width="128"
                  height="105"
                  fill="white"
                  transform="translate(0.777344)"
                />
              </clipPath>
            </defs>
          </svg>
          <div className="flex flex-col">
            <div className="font-medium text-white/80">Renewals in 30 Days</div>
            <div className="text-xl font-bold text-white">
              {stats.renewalsIn30Days}
            </div>
            <div className="text-sm text-white/50">
              {formatNumber(stats.renewalsIn30DaysCost)}
              {stats.currency}
            </div>
          </div>
        </div>
      </section>

      {/* Upcoming Renewals */}
      <section className="flex flex-col w-full bg-white/5 border border-white/10 p-4 rounded-2xl shadow-sm gap-2">
        <div className="text-lg font-semibold text-white/80">
          Upcoming renewals
        </div>
        {stats.renewalsIn30DaysList && stats.renewalsIn30DaysList.length > 0 ? (
          [...stats.renewalsIn30DaysList]
            .filter((sub) => sub.nextPaymentDate)
            .map((sub) => {
              const nextPayment = new Date(sub.nextPaymentDate as string);
              const daysLeft = Math.ceil(
                (nextPayment.getTime() - new Date().getTime()) /
                  (1000 * 60 * 60 * 24)
              );
              return { ...sub, daysLeft };
            })
            .sort((a, b) => a.daysLeft - b.daysLeft)
            .map((sub) => (
              <div
                key={sub._id}
                className="flex items-center justify-between hover:bg-white/5 p-2 rounded-lg transition-colors"
              >
                <div className="flex items-center gap-2">
                  <div className="w-2 h-2 bg-blue-500 rounded-full"></div>
                  <div className="font-medium text-white">
                    {sub.name || "Unnamed subscription"}
                  </div>
                </div>
                <div className="flex items-center gap-4">
                  <div className="text-sm text-white/50">
                    {sub.daysLeft} day{sub.daysLeft !== 1 && "s"}
                  </div>
                  <div className="font-semibold text-white">
                    {Number(sub.cost || 0).toFixed(2)} {stats.currency}
                  </div>
                </div>
              </div>
            ))
        ) : (
          <div className="text-sm text-white/50">No upcoming renewals</div>
        )}
      </section>

      {/* Charts */}
      <section className="flex w-full justify-between gap-4">
        <div className="w-1/2 bg-white/5 border border-white/10 p-4 rounded-2xl shadow-sm">
          <SpendingByChart
            title="Spending by Category"
            data={stats.spendingByCategory}
          />
        </div>

        <div className="w-1/2 bg-white/5 border border-white/10 p-4 rounded-2xl shadow-sm">
          <SpendingByChart
            title="Spending by Payment Method"
            data={stats.spendingByPaymentMethod}
          />
        </div>
      </section>

      {/* Monthly Trend */}
      <section className="flex flex-col w-full bg-white/5 border border-white/10 p-4 rounded-2xl shadow-sm gap-2">
        <div className="text-lg font-semibold text-white/80">
          Monthly Spending Trend
        </div>
        <MonthlySpendingTrend />
      </section>

      {/* Bottom Summary Cards */}
      <section className="flex flex-wrap w-full justify-between gap-4">
        <div className="flex gap-4 p-4 rounded-2xl shadow-sm bg-white/5 border border-white/10 items-center min-w-[250px] flex-1">
          <svg
            width="135"
            height="114"
            viewBox="0 0 135 114"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            className="h-6 w-auto"
          >
            <path
              d="M68.2518 22.6327C68.5019 22.0263 68.6574 21.8246 68.6554 21.6251C68.622 17.7245 69.086 17.1575 73.0378 17.1778C75.0672 17.1361 77.0277 16.4336 78.6213 15.1768C80.5404 13.8228 81.433 12.0479 81.0136 9.67064C80.8213 8.9131 80.7577 8.12844 80.8253 7.34977C81.3287 4.43695 84.7127 2.84528 86.9837 4.75391C89.6136 6.96443 92.4313 6.43306 95.2837 6.19349C96.0667 6.11998 96.8195 5.85303 97.4733 5.41665C98.1276 4.98028 98.6632 4.3881 99.0321 3.69345C101.671 -0.589153 104.727 -0.747332 107.587 3.33772C109.61 6.2256 112.711 6.2722 115.595 6.97513C116.675 7.23766 117.838 7.17203 118.915 7.44113C121.531 8.09747 122.227 9.01942 122.366 11.6743C122.567 15.5001 123.185 16.2458 126.859 17.0695C127.954 17.315 129.073 17.4731 130.148 17.7836C133.33 18.7024 134.5 21.4006 132.993 24.3364C132.674 25.0563 132.218 25.7077 131.652 26.2544C129.256 28.2549 129.432 30.6519 130.244 33.2982C130.68 34.5527 130.857 35.8826 130.763 37.2074C130.501 39.3864 129.638 40.0092 127.442 40.3006C125.333 40.5802 125.333 40.5803 124.21 41.5937C125.036 47.3853 125.943 53.0088 126.614 58.6585C127.326 64.6601 127.9 70.6827 128.374 76.7079C128.743 81.3981 128.838 94.0588 129.103 98.7608C129.388 103.83 127.15 106.129 122.665 108.376C118.296 110.47 113.523 111.588 108.678 111.654C97.3564 112.048 86.0261 112.184 74.6997 112.409C62.6985 112.648 50.6967 112.845 38.6962 113.106C30.8497 113.276 23.0059 113.64 15.1594 113.71C8.09522 113.776 4.95393 111.168 3.27961 104.313C1.84289 98.4208 0.818442 85.7325 0.752808 79.6384C0.628104 67.9766 0.370691 56.3158 0.293243 44.6553C0.290369 41.18 0.490103 37.7078 0.891254 34.2558C1.62307 27.6301 5.59716 24.4507 12.3239 23.7707C29.7956 22.0045 47.3068 22.8577 64.7962 22.6365C66.0058 22.6188 67.2102 22.6327 68.2518 22.6327ZM116.612 53.7043C112.528 52.62 110.246 53.4332 107.723 56.9984C104.871 61.0323 101.409 60.8978 98.9697 57.4894C98.5142 56.8294 97.8493 56.3428 97.0821 56.1092C96.3148 55.8754 95.4918 55.9084 94.7455 56.2024C93.5667 56.6123 92.4648 57.2175 91.4868 57.9929C89.947 59.3712 88.3429 60.189 86.3017 59.6193C84.1174 59.0096 84.1877 56.9757 83.7355 55.283C83.3732 53.9276 82.9662 52.584 82.4346 50.7338C80.6277 51.6146 79.2277 52.2126 77.9118 52.9589C76.2506 53.902 74.6511 53.8915 73.2183 52.6845C72.5423 52.1658 72.0585 51.4365 71.8426 50.612C71.6273 49.7875 71.693 48.9147 72.029 48.1315C72.4123 47.0814 72.7215 45.9968 73.1002 44.9414C73.471 44.0788 73.6042 43.1326 73.4861 42.201C73.3679 41.2695 73.003 40.3865 72.4287 39.6436C70.4958 40.0059 68.4185 40.0702 66.9903 38.2903C65.4985 36.4302 66.3766 34.335 67.0382 32.116C49.5856 32.3831 32.4059 31.5253 15.0884 33.3427C14.0575 33.4382 13.0957 33.9034 12.3807 34.6522C11.6656 35.4011 11.2455 36.383 11.1977 37.4173V37.4529C10.9647 47.6261 10.6825 57.7992 10.607 67.9773C10.5537 73.5253 10.7857 79.072 11.3021 84.5957C11.5548 87.2375 11.7832 92.9056 12.4783 97.4652C12.7166 98.9794 13.4956 100.356 14.6713 101.34C15.847 102.324 17.3395 102.849 18.8723 102.816H18.9228C31.0335 102.593 43.1416 102.255 55.2543 102.153C72.2029 102.01 89.1542 102.107 106.103 101.945C109.435 101.913 112.774 101.249 116.083 100.709C117.036 100.551 117.896 100.043 118.494 99.2846C119.092 98.5259 119.386 97.5722 119.319 96.6087C118.41 83.6336 117.515 65.7881 116.612 53.7043ZM91.1521 48.0415C94.8814 46.5247 98.3718 46.4262 101.862 47.9213C102.181 48.0065 102.515 48.0229 102.841 47.969C103.168 47.9151 103.478 47.7923 103.753 47.6088C106.905 45.3534 110.62 44.0133 114.486 43.7365C115.086 39.2032 117.172 35.7497 120.38 33.7603V25.2279C118.678 23.7243 116.942 22.5782 115.738 21.0207C114.472 19.3798 113.714 17.351 112.725 15.4752C110.62 14.8556 108.328 14.5073 106.359 13.5215C103.783 12.2351 101.464 11.5137 98.8765 13.3482C98.1795 13.7149 97.4076 13.9158 96.62 13.9349C93.8634 14.2834 91.1015 14.5741 88.1224 14.9114C86.517 19.1186 82.9249 21.4015 79.3853 23.3128C78.7591 26.3706 78.1835 29.1849 77.56 32.2317C81.2026 34.5794 81.8058 38.487 82.1327 42.576C86.0956 42.9672 89.4108 44.1474 91.1521 48.0415Z"
              fill="white"
              fillOpacity="0.8"
            />
            <path
              d="M40.3419 58.9184C49.6455 58.9184 58.9504 58.8486 68.2522 58.9668C70.6006 59.0564 72.9306 59.4141 75.1983 60.0327C77.4397 60.5893 78.5331 62.1658 78.5121 64.1079C78.5115 65.1342 78.1406 66.1259 77.4679 66.9004C76.7945 67.6755 75.8645 68.1809 74.8484 68.324C72.9799 68.6994 71.0811 68.9049 69.1757 68.9364C61.556 69.0302 53.9354 69.0237 46.3159 69.0532C43.0579 69.0657 39.7971 68.9967 36.543 69.1057C32.7362 69.233 28.9361 69.5874 25.1293 69.6964C23.4598 69.7883 21.786 69.6216 20.1674 69.2028C19.248 68.9114 18.4503 68.326 17.8977 67.5357C17.3452 66.7448 17.0689 65.7945 17.1115 64.8312C17.2887 63.0591 18.3946 61.7464 20.6458 61.3034C23.9407 60.6504 27.2748 60.1221 30.6136 59.7814C33.8428 59.4533 37.1029 59.4361 40.3492 59.2818C40.3472 59.1597 40.3446 59.0365 40.3419 58.9184Z"
              fill="white"
              fillOpacity="0.8"
            />
            <path
              d="M37.6565 52.507C32.6283 52.2313 27.5995 51.9734 22.574 51.661C21.8087 51.6137 20.8261 51.5447 20.3528 51.0748C19.5462 50.2734 18.5671 49.1368 18.5855 48.1575C18.6038 47.1782 19.6027 46.0388 20.4671 45.3261C21.067 44.8318 22.1612 44.8362 23.042 44.8008C29.4203 44.5383 35.8005 44.3415 42.1788 44.0842C43.6293 44.0264 45.0752 43.8381 46.5224 43.7022C46.9637 43.6284 47.4083 43.5765 47.8548 43.5471C50.7427 43.5655 53.1711 45.3133 53.3817 47.4983C53.5786 49.525 52.1053 51.0655 49.0632 51.8433C47.9682 52.0583 46.8607 52.2035 45.7473 52.2779C45.6352 52.2859 45.5227 52.2869 45.4105 52.2811H37.6697L37.6565 52.507Z"
              fill="white"
              fillOpacity="0.8"
            />
            <path
              d="M92.8217 84.2211C89.712 83.9401 86.5951 83.719 83.4978 83.3383C82.6098 83.2667 81.7795 82.8723 81.1632 82.2291C80.5725 81.4165 80.052 80.1242 80.2929 79.2585C80.5305 78.4052 81.6528 77.5619 82.577 77.2022C83.6842 76.771 84.9897 76.8182 86.2137 76.727C90.7805 76.385 95.3473 76.0346 99.9194 75.7766C100.923 75.7825 101.921 75.9236 102.888 76.1947C103.617 76.3201 104.278 76.7014 104.751 77.2711C105.223 77.8408 105.477 78.5601 105.465 79.2998C105.56 81.0267 104.841 82.443 103.129 82.9622C101.528 83.4472 99.882 83.7682 98.2162 83.9205C96.4388 84.0819 94.6359 83.9579 92.8434 83.9579L92.8217 84.2211Z"
              fill="white"
              fillOpacity="0.8"
            />
            <path
              d="M89.9034 35.6755C90.2598 35.0513 90.6851 33.6676 91.6027 32.8117C95.3668 29.299 99.2405 25.9 103.173 22.577C104.076 21.9062 105.14 21.486 106.257 21.3588C106.952 21.2399 107.666 21.3134 108.321 21.5716C108.977 21.8298 109.549 22.2625 109.976 22.8231C110.402 23.3836 110.667 24.0506 110.741 24.7511C110.815 25.4515 110.696 26.1588 110.397 26.7964C109.821 28.0071 108.981 29.0733 107.939 29.9156C104.191 32.9393 100.341 35.8368 96.5022 38.747C95.8853 39.2313 95.1876 39.6032 94.4413 39.8452C92.0674 40.5495 89.8535 38.8122 89.9034 35.6755Z"
              fill="white"
              fillOpacity="0.8"
            />
            <path
              d="M97.2782 21.7606C97.3687 23.9751 95.0013 26.5262 92.8807 26.4954C90.9537 26.4678 88.7418 24.2376 88.7175 22.2981C88.6893 20.0377 90.9655 17.354 92.9332 17.3271C94.9442 17.3002 97.1896 19.5934 97.2782 21.7606Z"
              fill="white"
              fillOpacity="0.8"
            />
            <path
              d="M104.906 36.7858C104.747 34.5096 106.882 32.1758 109.224 32.0662C110.294 32.0733 111.323 32.4812 112.107 33.2093C112.892 33.9374 113.375 34.9327 113.462 35.9994C113.429 37.124 113.012 38.2034 112.28 39.0577C111.548 39.9119 110.545 40.4894 109.439 40.6937C108.882 40.7459 108.321 40.6852 107.789 40.5152C107.256 40.3453 106.763 40.0697 106.34 39.7048C105.917 39.3398 105.572 38.893 105.325 38.3914C105.079 37.8899 104.936 37.3438 104.906 36.7858Z"
              fill="white"
              fillOpacity="0.8"
            />
          </svg>

          <div className="flex flex-col">
            <div className="font-medium text-white/80">Most cheap (yearly)</div>
            <div className="text-xl font-bold text-white">
              {stats.mostCheapSub.name}
            </div>
            <div className="text-sm text-white/50">
              {formatNumber((stats.mostCheapSub.cost || 0) * 12)}
              {stats.currency}/year
            </div>
          </div>
        </div>

        <div className="flex gap-4 p-4 rounded-2xl shadow-sm bg-white/5 border border-white/10 items-center min-w-[250px] flex-1">
          <svg
            width="149"
            height="153"
            viewBox="0 0 149 153"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            className="h-6 w-auto"
          >
            <g clipPath="url(#clip0_6_1901)">
              <path
                d="M58.5772 57.7152C55.833 57.1967 53.0763 56.7308 50.3446 56.1466C47.1443 55.4946 44.1214 54.1622 41.4808 52.24C39.1836 50.5493 37.5533 48.3807 37.5684 45.506C37.5947 40.4699 37.8723 35.4339 38.1289 30.4017C38.2261 28.4983 38.6251 26.6153 38.7668 24.7139C38.8955 22.5188 39.4791 20.3743 40.4806 18.4168C41.4821 16.4593 42.8797 14.7315 44.5846 13.3428C46.5484 11.6961 48.6251 10.0027 50.9387 8.98739C60.5081 4.78683 70.2273 1.11721 80.9801 1.36596C88.1657 1.53267 95.3625 1.35749 102.45 2.80603C107.931 3.9264 112.915 6.13686 117.06 9.98102C120.665 13.3231 122.808 17.3543 122.95 22.3897C123.055 26.0757 123.379 29.7552 123.601 33.3644C127.382 34.2445 131.018 34.874 134.504 35.9793C136.844 36.7299 139.048 37.8529 141.03 39.3049C144.029 41.5141 145.024 44.8871 145.171 48.5055C145.442 55.2323 145.63 61.9637 145.965 68.6876C146.407 77.5416 147.117 86.3851 147.421 95.243C147.767 105.339 147.896 115.446 147.894 125.547C147.894 128.536 147.073 131.52 146.73 134.515C146.402 137.385 144.522 138.762 142.088 139.717C136.561 141.919 130.797 143.471 124.913 144.345C110.767 146.319 96.4028 146.13 82.3138 143.783C79.2369 143.29 76.2394 142.299 72.9459 141.471C72.4641 141.865 71.7645 142.409 71.095 142.988C64.1231 149.009 55.9681 152.018 46.8339 152.616C36.3929 153.299 26.4815 151.454 17.2646 146.414C9.17388 141.989 3.64035 135.465 1.70941 126.309C-2.93287 104.301 11.1606 81.8485 32.9379 76.3116C34.6345 75.8804 36.175 74.8428 37.8703 74.4004C40.0015 73.8451 42.2639 73.1435 44.3858 73.3502C47.4706 73.6541 50.4898 74.6918 53.5253 75.4617C54.7921 75.7826 56.0286 76.2191 57.487 76.6667C57.8512 70.3048 58.2044 64.1867 58.5772 57.7152ZM43.5943 145.074C45.1826 144.889 47.7803 144.78 50.2934 144.262C61.9631 141.855 69.9838 135.446 72.707 123.395C73.7624 118.789 73.8766 114.017 73.0417 109.365C71.2171 99.0925 65.9701 91.3037 56.5798 86.5518C53.5876 85.0376 50.4589 83.7762 47.3308 82.5567C43.943 81.2598 40.2177 81.1403 36.7539 82.2174C24.2691 85.8148 15.3573 93.3095 11.3294 105.92C10.2577 109.11 9.55048 112.411 9.22114 115.759C8.24713 127.791 12.6013 135.624 23.0634 140.593C29.2448 143.529 35.7891 144.856 43.5943 145.073V145.074ZM74.9202 33.3035C82.8382 32.5204 90.3526 32.0445 97.7725 30.9366C101.863 30.2964 105.847 29.0927 109.608 27.3596C114.105 25.3053 114.588 21.5379 111.408 17.7383C110.811 16.9209 110.068 16.2212 109.216 15.6748C106.565 14.2565 103.952 12.5244 101.098 11.7775C90.7576 9.05446 79.9831 8.39117 69.3879 9.82546C63.5634 10.6078 57.9674 12.2002 52.9215 15.346C50.1301 17.0873 47.5809 19.1219 46.1757 22.2093C44.8879 25.0381 45.5193 27.3484 48.2812 28.7609C50.3524 29.8782 52.5933 30.6472 54.9141 31.0371C61.6797 31.9789 68.49 32.5997 74.9202 33.3027V33.3035ZM115.538 34.5609C111.378 35.7889 107.686 37.1174 103.885 37.9542C93.9677 40.1372 83.8798 40.4758 73.7683 40.1969C63.7779 39.9212 53.8259 39.3523 44.561 34.815V46.526C47.3452 48.457 49.4586 49.423 53.6644 49.9055C60.2317 50.6589 66.8183 51.3612 73.4165 51.711C85.0842 52.3462 96.7782 51.0659 108.032 47.9208C110.799 47.1482 113.561 46.23 115.54 44.7415L115.538 34.5609ZM139.007 79.2159C133.685 81.5998 129.117 84.0282 124.292 85.732C112.514 89.8913 100.28 89.9129 88.0233 88.8424C83.1368 88.4152 78.2885 87.5508 73.5182 86.8984C74.9287 89.1627 76.5452 91.4474 77.8284 93.9061C79.1115 96.3647 80.0711 99.013 81.2807 101.831C82.5626 102.024 83.9816 102.349 85.4157 102.435C98.6553 103.252 111.939 101.89 124.738 98.4053C128.923 97.2685 132.905 95.3697 136.953 93.7512C137.975 93.3416 139.017 92.8015 139.012 91.3884C138.997 87.3795 139.007 83.3712 139.007 79.2153V79.2159ZM66.3156 77.879C68.7532 78.6489 71.2611 79.6852 73.8713 80.2234C85.8876 82.6906 98.2372 83.0864 110.387 81.3943C119.459 80.1597 127.611 76.4915 135.006 71.1489C135.947 70.4689 137.172 69.508 137.316 68.5314C137.657 66.239 137.425 63.8618 137.425 61.4701C137.126 61.5175 136.836 61.6135 136.568 61.7543C130.469 66.3001 123.458 68.4704 116.078 69.7561C105.207 71.5683 94.1463 71.9575 83.1756 70.9146C77.6958 70.4394 72.2508 69.5802 67.1097 67.4314C66.4534 67.1583 65.7791 66.9404 64.7913 66.5788C65.3144 70.4354 65.7738 73.8497 66.3156 77.8783V77.879ZM77.2941 136.003C88.022 139.778 126.426 139.865 140.463 130.555C140.156 127.489 139.84 124.342 139.516 121.115C120.45 128.32 101.014 129.126 81.2755 127.041C79.9116 130.108 78.6029 133.055 77.2941 136.002V136.003ZM139.021 102.337C121.035 108.857 101.747 110.962 82.7785 108.475V119.56C83.0863 119.77 83.1756 119.883 83.2721 119.889C85.1761 120.008 87.0795 120.12 88.9822 120.223C101.669 120.914 114.388 119.72 126.726 116.679C131.037 115.665 135.178 114.029 139.019 111.822L139.021 102.337ZM124.039 41.8581C123.828 42.1817 123.579 42.3924 123.607 42.5486C124.363 46.4997 122.042 48.8081 119.262 50.9536C115.603 53.7759 111.315 55.08 106.938 56.0828C94.2086 58.9141 81.1121 59.7211 68.131 58.4739C67.1951 58.3919 66.2453 58.4635 65.3027 58.4635C65.964 59.5102 66.9443 60.3166 68.0988 60.7639C70.2923 61.6105 72.556 62.2648 74.8631 62.7191C88.5215 64.9283 102.465 64.6626 116.03 61.9348C121.107 60.9457 126.097 59.3915 130.179 56.0383C131.968 54.5365 133.487 52.7382 134.667 50.7219C135.897 48.6393 135.253 46.828 133.269 45.4936C130.494 43.6224 127.344 42.3815 124.039 41.8581Z"
                fill="white"
                fillOpacity="0.8"
              />
              <path
                d="M42.2467 99.8165V112.156C44.045 112.834 45.7253 113.393 47.3497 114.092C53.7306 116.839 55.3006 122.833 51.1171 128.347C49.3942 130.618 48.0323 131.537 42.9509 133.871C42.4718 136.308 41.9887 138.71 41.5299 141.117C41.2746 142.457 40.6346 143.495 39.171 143.529C37.6266 143.565 37.0839 142.306 36.8083 141.096C36.2917 138.821 35.9399 136.506 35.4713 133.941C33.6027 133.443 31.5687 132.915 29.5439 132.352C28.5634 132.121 27.6036 131.81 26.6744 131.422C24.8229 130.559 24.0779 129.114 24.4323 127.373C24.7605 125.759 26.148 124.738 28.2844 124.879C30.6118 125.031 32.924 125.426 35.1838 125.708C36.1276 123.106 36.2339 121.557 35.8243 117.126C34.2491 116.535 32.546 116.014 30.9432 115.275C24.4586 112.284 23.0298 105.807 27.6248 100.33C29.5216 97.9446 32.0208 96.1088 34.8642 95.0127C36.5982 94.384 37.2926 93.3279 37.3583 91.5296C37.374 90.3002 37.6421 89.0873 38.1459 87.9663C38.3622 87.6046 38.6623 87.3008 39.021 87.0802C39.3796 86.8597 39.7861 86.7284 40.2061 86.6982C40.6126 86.8138 40.9859 87.0244 41.2948 87.3126C41.6037 87.6014 41.8393 87.9597 41.9822 88.3575C42.2635 89.7916 42.4172 91.248 42.4416 92.7096C43.987 93.0614 45.5133 93.492 47.0143 94.0007C49.4093 94.9432 50.5428 96.8013 50.2507 98.9186C49.9921 100.793 48.9728 101.426 47.2243 100.657C45.6937 99.9845 44.2682 98.9882 42.2467 99.8165ZM36.3344 102.263C33.0527 104.21 31.3725 106.281 31.9789 107.824C32.7009 109.667 34.3844 110.132 36.3344 110.385V102.263ZM42.4672 125.387C44.6482 124.582 46.6468 123.619 46.5811 121.409C46.526 119.556 44.4841 119.178 42.8242 118.926C42.7291 118.911 42.6187 118.996 42.1993 119.153C42.1993 120.443 42.1764 121.856 42.2098 123.267C42.2249 123.884 42.355 124.499 42.4672 125.387Z"
                fill="white"
                fillOpacity="0.8"
              />
            </g>
            <defs>
              <clipPath id="clip0_6_1901">
                <rect
                  width="147.676"
                  height="152.27"
                  fill="white"
                  transform="translate(0.534424 0.703125)"
                />
              </clipPath>
            </defs>
          </svg>
          <div className="flex flex-col">
            <div className="font-medium text-white/80">
              Most expensive (Yearly)
            </div>
            <div className="text-xl font-bold text-white">
              {stats.mostExpensiveSub.name}
            </div>
            <div className="text-sm text-white/50">
              {formatNumber((stats.mostExpensiveSub.cost || 0) * 12)}
              {stats.currency}/year
            </div>
          </div>
        </div>

        <div className="flex gap-4 p-4 rounded-2xl shadow-sm bg-white/5 border border-white/10 items-center min-w-[250px] flex-1">
          <svg
            width="161"
            height="155"
            viewBox="0 0 161 155"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            className="h-6 w-auto"
          >
            <g clipPath="url(#clip0_8_2826)">
              <path
                d="M158.715 93.6772C157.802 100.245 154.818 106.136 151.805 111.92C146.72 121.822 139.589 130.529 130.887 137.462C120.603 145.626 108.844 150.515 95.9904 152.771C88.0228 154.17 79.9963 155.188 71.859 154.774C52.2411 153.776 35.307 146.909 21.5437 132.492C15.7041 126.273 10.7406 119.285 6.79072 111.721C4.50991 107.47 3.65356 103.024 2.8853 98.4666C1.46538 90.0357 0.591533 81.6125 1.52498 72.9954C2.67737 62.3531 5.61243 52.3786 10.9177 43.1078C17.3494 31.654 26.1617 21.7158 36.7593 13.9646C47.3128 6.30798 59.2571 2.38546 72.1621 0.825729C85.8424 -0.937555 99.7449 0.512547 112.769 5.06085C125.547 9.5513 136.951 16.4031 144.663 27.8945C152.375 39.3859 157.726 51.7955 159.542 65.8408C161.05 77.4943 159.507 87.9798 158.715 93.6772ZM151.262 76.3042C151.197 68.1236 150.427 60.0325 147.463 52.4251C145.02 46.1571 142.117 36.608 137.175 31.6597C130.308 22.099 120.75 16.2616 109.925 12.4034C97.5833 7.91381 84.3234 6.55027 71.3271 8.43433C58.0477 10.352 46.1501 15.2312 36.1452 24.3003C33.1929 26.9822 30.3803 29.8139 27.7183 32.7848C16.4134 45.378 10.3178 60.4191 10.3243 85.1613C10.3282 100.587 17.9305 113.773 28.8189 125.043C40.3765 137.006 54.3094 143.003 70.6049 144.343C78.5187 144.991 86.3198 144.129 94.1022 142.926C117.373 139.33 133.983 126.736 144.693 105.822C151.148 93.2167 150.872 80.9374 151.262 76.3042Z"
                fill="white"
                fillOpacity="0.8"
              />
              <path
                d="M87.7202 74.8117C89.3144 74.8117 90.5102 74.8117 91.706 74.8117C101.785 74.8253 111.863 74.8221 121.941 74.8766C123.26 74.8869 124.572 75.0575 125.85 75.3844C126.511 75.5219 127.105 75.885 127.529 76.4117C127.953 76.9383 128.182 77.5965 128.176 78.273C128.242 78.9481 128.077 79.6258 127.708 80.1952C127.339 80.764 126.787 81.1907 126.144 81.4041C124.474 81.9586 122.728 82.2511 120.968 82.2705C111.113 82.1823 101.259 81.9592 91.4048 81.7874C89.3008 81.7504 87.1942 81.7951 85.0935 81.6881C83.9942 81.6505 82.9066 81.454 81.8637 81.1045C80.2158 80.5143 79.5479 79.2516 79.6716 77.448C79.9308 73.6956 80.1115 69.9367 80.2495 66.1778C80.6977 53.9944 81.0987 41.8091 81.5593 29.6257C81.6635 28.4129 81.8559 27.2091 82.1351 26.0243C82.4389 24.3977 83.3886 23.4548 85.0916 23.458C86.8535 23.4613 87.6619 24.6112 87.9664 26.145C88.2145 27.337 88.346 28.5505 88.3589 29.7683C88.3473 42.8479 88.3065 55.9277 88.2365 69.008C88.2268 70.7623 87.9327 72.5153 87.7202 74.8117Z"
                fill="white"
                fillOpacity="0.8"
              />
            </g>
            <defs>
              <clipPath id="clip0_8_2826">
                <rect
                  width="160"
                  height="155"
                  fill="white"
                  transform="translate(0.777344)"
                />
              </clipPath>
            </defs>
          </svg>
          <div className="flex flex-col">
            <div className="font-medium text-white/80">Oldest Subscription</div>
            <div className="text-xl font-bold text-white">
              {stats.oldestSub.name}
            </div>
            <div className="text-sm text-white/50">
              Since {formatYMD(stats.oldestSub.createdAt)}
            </div>
          </div>
        </div>

        <div className="flex gap-4 p-4 rounded-2xl shadow-sm bg-white/5 border border-white/10 items-center min-w-[250px] flex-1">
          <svg
            width="146"
            height="148"
            viewBox="0 0 146 148"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            className="h-6 w-auto"
          >
            <g clipPath="url(#clip0_8_2647)">
              <path
                d="M72.5459 109.514C56.9547 120.9 41.7081 132.018 26.4909 143.175C25.3736 143.995 24.5213 145.168 23.4442 146.054C20.952 148.1 18.5995 147.279 18.0337 144.088C17.816 142.817 17.8768 141.513 18.2119 140.267C19.7991 134.559 21.3144 128.816 23.2447 123.221C26.9015 112.625 30.8223 102.12 34.6377 91.5799C35.0351 90.4816 35.4695 89.3976 35.8106 88.5044C25.113 78.7163 14.9855 68.7256 5.10153 58.4879C3.77221 57.0857 2.64716 55.5021 1.75952 53.7843C0.629292 51.6266 1.41504 50.179 3.7933 49.8635C6.14224 49.5403 8.51047 49.379 10.8814 49.3807C19.9342 49.4339 28.9858 49.6351 38.0386 49.6858C41.5859 49.7059 45.1345 49.4748 48.8708 49.3522C50.5946 45.0394 52.2849 40.8597 53.9388 36.6657C58.2905 25.6306 62.6345 14.5918 66.9705 3.54938C67.1207 3.14478 67.2961 2.74997 67.4955 2.3673C68.7506 0.0700539 71.1037 -0.14546 72.6741 1.98886C73.3337 2.9738 73.8703 4.03615 74.2717 5.15206C77.6817 13.5478 80.9294 22.0124 84.4993 30.3381C86.5772 35.1825 89.16 39.8106 91.5726 44.655C92.6044 44.655 93.4498 44.6719 94.2985 44.655C104.855 44.4129 115.411 44.1078 125.969 43.9449C131.022 43.867 136.08 44.0904 141.137 44.1053C142.788 44.1105 144.16 44.5246 144.891 46.0831C145.248 46.8258 145.348 47.667 145.174 48.4729C145 49.2789 144.563 50.0034 143.931 50.5316C140.607 53.7648 137.29 57.0118 133.823 60.0867C124.62 68.2485 115.338 76.3197 106.095 84.4363C105.22 85.2049 104.401 86.0377 103.586 86.8128C103.677 87.3133 103.807 87.8059 103.974 88.2863C111.01 103.442 115.372 119.431 118.698 135.742C119.267 138.044 119.708 140.375 120.02 142.724C120.36 146.481 119.099 147.008 115.496 147.588C110.454 148.405 107.389 145.742 104.186 142.804C95.8352 135.144 87.4802 127.484 80.1836 118.763C77.6953 115.789 75.2465 112.786 72.5459 109.514ZM29.305 132.464L29.7658 132.891C30.3723 132.462 30.9958 132.056 31.5829 131.6C44.0115 121.934 56.4417 112.268 68.8736 102.602C71.9614 100.208 73.6781 100.235 76.6046 102.788C78.5666 104.479 80.4167 106.297 82.1418 108.23C90.1602 117.322 99.1916 125.363 108.086 133.546C108.447 133.878 108.869 134.142 109.579 134.676C109.472 133.87 109.459 133.456 109.358 133.064C105.711 118.974 102.014 104.896 96.77 91.293C95.3756 87.6755 95.7459 84.8557 98.8601 82.0755C109.162 72.8787 119.251 63.4388 129.414 54.0908C130.249 53.3229 131.079 52.549 132.395 51.3293C130.568 51.3293 129.497 51.317 128.427 51.3293C116.786 51.4884 105.14 51.4851 93.5075 51.8902C88.4965 52.0648 85.3512 49.9427 83.1846 45.7455C83.1348 45.6494 83.0895 45.5508 83.0474 45.4522C80.976 40.5941 78.7751 35.7873 76.8758 30.8631C74.897 25.735 73.2204 20.4857 71.3846 15.2986C71.0357 14.3126 70.5619 13.3712 69.9093 11.862C68.5435 15.2667 67.2715 18.0794 66.2746 20.9874C63.1267 30.1738 60.0062 39.3711 57.024 48.6127C55.1008 54.5723 50.7404 57.1 45.0362 56.706C36.5459 56.1218 28.0375 55.7823 19.5349 55.3941C17.2046 55.2877 14.869 55.378 12.1257 55.378C15.0386 58.0147 17.7573 60.4314 20.4223 62.902C27.5428 69.4955 34.6751 76.0789 41.7193 82.7532C42.8488 83.9073 43.7754 85.2445 44.46 86.7083C45.42 88.6109 45.0962 90.1421 43.2947 91.1742C41.9768 91.9298 41.5794 92.9918 41.1768 94.2102C39.0108 100.766 36.7609 107.291 34.7114 113.879C32.7993 120.043 31.0987 126.268 29.3043 132.464H29.305Z"
                fill="white"
                fillOpacity="0.8"
              />
            </g>
            <defs>
              <clipPath id="clip0_8_2647">
                <rect
                  width="145"
                  height="148"
                  fill="white"
                  transform="translate(0.777344)"
                />
              </clipPath>
            </defs>
          </svg>
          <div className="flex flex-col">
            <div className="font-medium text-white/80">Latest Subscription</div>
            <div className="text-xl font-bold text-white">
              {stats.latestSub.name}
            </div>
            <div className="text-sm text-white/50">
              Added {formatYMD(stats.latestSub.createdAt)}
            </div>
          </div>
        </div>
      </section>
    </div>
  );
}
